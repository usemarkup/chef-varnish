# THIS IS AN AUTO GENERATED FILE BY CHEF
# PLEASE SEE THE VARNISH COOKBOOK FOR CHANGES

vcl 4.0;
import std;

# Default backend definition.
backend default {
    .host = "127.0.0.1";
    .port = "8080";
    .connect_timeout = 1s;
}

sub vcl_recv {
<%=::File.read('/etc/varnish/subroutines/recv.vcl')%>
}

sub vcl_backend_response {
<%=::File.read('/etc/varnish/subroutines/backend_response.vcl')%>
}

sub vcl_backend_error {
<%=::File.read('/etc/varnish/subroutines/backend_error.vcl')%>
}

sub vcl_deliver {
    # Happens when we have all the pieces we need, and are about to send the
    # response to the client.
    #
    # You can do accounting or modifying the final object here.

    # Remove some headers: Apache version & OS
    unset resp.http.Server;
    unset resp.http.X-Drupal-Cache;
    unset resp.http.X-Varnish;
    unset resp.http.Link;
    unset resp.http.X-Generator;
    unset resp.http.X-url;
    unset resp.http.X-url;
    unset resp.http.Via;
    unset resp.http.X-Backend;
    unset resp.http.X-host;
    unset resp.http.Forwarded;
    unset resp.http.X-Powered-By;

    set resp.http.X-Server-Identity = server.hostname;

    return (deliver);
}
